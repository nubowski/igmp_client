# IGMPv2 Client (RFC 2236)

–ö–æ—Å–Ω–æ–ª—å–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞, —ç–º—É–ª–∏—Ä—É—é—â–∞—è –ø–æ–≤–µ–¥–µ–Ω–∏–µ IGMPv2-–∫–ª–∏–µ–Ω—Ç–∞ –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É [RFC 2236](https://tools.ietf.org/html/rfc2236).

## üìå –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

- –û—Ç–ø—Ä–∞–≤–∫–∞ IGMP Report (0x16) –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∏–∑ —Å–µ—Ç–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ General –∏ Group-Specific Query (0x11)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Leave Group (0x17) –ø—Ä–∏ –æ—Ç–ø–∏—Å–∫–µ
- FSM-–º–æ–¥–µ–ª—å –∫–ª–∏–µ–Ω—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ RFC (—Å–º. –Ω–∏–∂–µ)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ suppression: –æ—Ç–º–µ–Ω–∞ Report –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —á—É–∂–æ–≥–æ
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ IGMPv1 (—Ç–æ–ª—å–∫–æ –ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ Leave)

## ‚öôÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–æ–º–∞–Ω–¥—ã
```
add <ip>        ‚Äì –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –≥—Ä—É–ø–ø—É
del <ip>        ‚Äì –æ—Ç–ø–∏—Å–∫–∞ –æ—Ç –≥—Ä—É–ø–ø—ã
print           ‚Äì —Å–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø –∏ —Ç–∞–π–º–µ—Ä–æ–≤
set_timer <ms>  ‚Äì –∏–∑–º–µ–Ω–∏—Ç—å Max Resp Time
status          ‚Äì –≤—ã–≤–µ—Å—Ç–∏ —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
exit            ‚Äì –≤—ã—Ö–æ–¥
```

## üß† –ü–æ—á–µ–º—É —Ç–∞–∫
–î–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ CLI –∏ –ø—Ä–∏—ë–º–∞ IGMP-–ø–∞–∫–µ—Ç–æ–≤ –≤—ã–±—Ä–∞–Ω—ã –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ—Ç–æ–∫–∏, —Ç.–∫. `select()` –∏–ª–∏ `epoll()` —É—Å–ª–æ–∂–Ω—è—é—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π –≤—ã–≥–æ–¥—ã –≤ —Ä–∞–º–∫–∞—Ö –∑–∞–¥–∞—á–∏.

FSM —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å `GroupState` –∏ `GroupEvent` ‚Äî –æ—á–µ–≤–∏–¥–Ω–æ–µ, –±—ã—Å—Ç—Ä–æ–µ –∏ —É–¥–æ–±–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ.

## üîÅ FSM: 3 —Å–æ—Å—Ç–æ—è–Ω–∏—è

| –°–æ—Å—Ç–æ—è–Ω–∏–µ        | –û–ø–∏—Å–∞–Ω–∏–µ                       |
| ---------------- | ------------------------------ |
| NON\_MEMBER      | –ù–µ –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –≥—Ä—É–ø–ø—É          |
| DELAYING\_MEMBER | –¢–∞–π–º–µ—Ä –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π Report  |
| IDLE\_MEMBER     | –ü–æ–¥–ø–∏—Å–∞–Ω, Report —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω |

## üîí –ü–æ—Ç–æ–∫–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –î–∞—Ç–∞ FSM (`GroupInfo[]`) –Ω–µ –∑–∞—â–∏—â–µ–Ω—ã –º—å—é—Ç–µ–∫—Å–æ–º. –í —Ä–∞–º–∫–∞—Ö –º–∏–∫—Ä–æ-–ø—Ä–æ–µ–∫—Ç–∞, —Å –æ–¥–Ω–∏–º CLI-–ø–æ—Ç–æ–∫–æ–º –∏ —Ä–µ–¥–∫–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏, —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ.

- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –æ–±–µ—Ä–Ω—É—Ç—å `group_states[]` –≤ `pthread_mutex_t`.

## ‚ùå –û—à–∏–±–∫–∏

–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –º–µ—Å—Ç–∞—Ö, –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–ª—è —Å–µ—Ç–µ–≤–æ–π –ª–æ–≥–∏–∫–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–∫–æ–≤, –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤, –∏–Ω–ø—É—Ç –∫–æ–º–∞–Ω–¥). –§–∞—Ç–∞–ª—å–Ω—ã–µ –∑–∞–≤–µ—Ä—à–∞—é—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É —á–µ—Ä–µ–∑ `exit(1)`, –ø—Ä–æ—á–∏–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è. –ü—Ä–æ–µ–∫—Ç —Å–æ–≤—Å–µ–º –Ω–µ–±–æ–ª—å—à–æ–π –∏ –Ω–µ —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ —Å–ª–æ–∏, —Å–∏—Å—Ç–µ–º–∞ –∫–æ–¥–æ–≤ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è–º.